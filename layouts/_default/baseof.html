<!DOCTYPE html>
<html lang="{{ .Site.Language }}" dir="{{ or site.Language.LanguageDirection `ltr` }}" class="{{- if site.Params.defaultTheme -}}{{- site.Params.defaultTheme -}}{{- end -}}">
<head>
    {{- partial "head.html" . }}
    {{- /* Load custom CSS after theme CSS */ -}}
    {{ $css := resources.Get "css/custom.css" }}
    <link rel="stylesheet" href="{{ $css.RelPermalink }}">
    
    {{- /* Theme initialization */ -}}
    <script>
        // Immediately set theme on page load to avoid flash
        const getStoredTheme = localStorage.getItem("pref-theme");
        const getPreferredTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        const theme = getStoredTheme || getPreferredTheme;
        
        document.documentElement.classList.remove('dark', 'light');
        document.documentElement.classList.add(theme);
        document.body.classList.remove('dark', 'light');
        document.body.classList.add(theme);
    </script>
</head>
<body class="{{- if site.Params.defaultTheme -}} {{- site.Params.defaultTheme -}} {{- end -}}" id="top">
    {{- partial "sidebar.html" . -}}
    
    <div class="main">
        {{- block "main" . }}{{ end }}
    </div>

    {{- partial "footer.html" . }}

    {{- /* Theme toggle script with debugging */ -}}
    <script>
        window.addEventListener('load', function() {
            console.log('Theme toggle script loaded');
            
            const themeToggle = document.getElementById("theme-toggle");
            console.log('Theme toggle button:', themeToggle);
            
            if (themeToggle) {
                themeToggle.addEventListener("click", function(e) {
                    e.preventDefault();
                    console.log('Theme toggle clicked');
                    
                    const isDark = document.documentElement.classList.contains('dark');
                    const newTheme = isDark ? 'light' : 'dark';
                    console.log('Switching to', newTheme, 'mode');
                    
                    // Remove both classes first
                    document.documentElement.classList.remove('dark', 'light');
                    document.body.classList.remove('dark', 'light');
                    
                    // Add new theme class
                    document.documentElement.classList.add(newTheme);
                    document.body.classList.add(newTheme);
                    
                    // Store preference
                    localStorage.setItem("pref-theme", newTheme);
                    
                    console.log('New HTML classes:', document.documentElement.className);
                    console.log('New body classes:', document.body.className);
                    console.log('Stored theme:', localStorage.getItem("pref-theme"));
                });
            } else {
                console.error('Theme toggle button not found!');
            }
        });
    </script>
</body>
</html> 